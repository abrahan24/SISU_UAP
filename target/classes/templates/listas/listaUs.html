<!DOCTYPE html>
<html lang="en">
  <head th:insert="~{layout/head :: head}"></head>

  <body data-topbar="colored">
    <!-- Begin page -->
    <div id="layout-wrapper">
      <div th:insert="~{layout/topbar :: topbar}"></div>

      <!-- ========== Left Sidebar Start ========== -->
      <div class="vertical-menu">
        <div th:insert="~{layout/sidebar :: sidebar}"></div>
      </div>
      <!-- Left Sidebar End -->

      <!-- ============================================================== -->
      <!-- Start right Content here -->
      <!-- ============================================================== -->
      <div class="main-content">
        <div class="page-content">
          <!-- Page-Title -->
          <div class="page-title-box">
            <div class="container-fluid">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h4 class="page-title mb-1">GESTION ADMINISTRADOR</h4>
                  <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item">
                      <a href="javascript: void(0);">Administrador</a>
                    </li>
                    <li class="breadcrumb-item active">Lista de Usuarios</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>

          <!-- end page title end breadcrumb -->

          <div class="page-content-wrapper">
            <div class="container-fluid">
              <div class="row">
                <div class="col-12">
                  <div class="card">
                    <div class="card-body">
                      <div class="text-right mb-3" style="align-items: start">
                        <button
                          type="button"
                          class="btn btn-info btn-sm waves-effect waves-light"
                          onclick="NuevoRegistro()"
                        >
                          AGREGAR NUEVO REGISTRO
                        </button>
                      </div>
                      <table
                        id="datatable-buttons"
                        class="table table-striped table-bordered dt-responsive nowrap botonesH"
                        style="
                          border-collapse: collapse;
                          border-spacing: 0;
                          width: 100%;
                        "
                      >
                        <thead>
                          <tr>
                            <th>N°</th>
                            <th>Usuario</th>
                            <th>Clave</th>
                            <th>Funciones</th>
                            <th>Roles Asignados</th>
                            <th>Operacion</th>
                          </tr>
                        </thead>

                        <tbody>
                          <tr
                            th:each="us , num : ${usuarios}"
                            th:if="${us.estado_usuario !='X'}"
                          >
                            <td th:text="${num.index +1}"></td>
                            <td th:text="${us.apodo}"></td>
                            <td th:text="${us.clave}"></td>
                            <td class="text-center">
                              <a
                                th:href="${'../../../../editarUs/' + us.idUsuario}"
                              >
                                <button
                                  type="button"
                                  class="btn btn-primary alertEdit btn-sm"
                                >
                                  <i
                                    class="dripicons-document-edit"
                                    data-toggle="tooltip"
                                    data-placement="bottom"
                                    title="MODIFICAR"
                                  ></i>
                                </button>
                              </a>
                              <a
                                th:href="${'../../../../eliminarUs/' + us.idUsuario}"
                              >
                                <button
                                  type="button"
                                  class="btn btn-danger alertElimin btn-sm"
                                >
                                  <i
                                    class="dripicons-trash"
                                    data-toggle="tooltip"
                                    data-placement="bottom"
                                    title="ELIMINAR"
                                  ></i>
                                </button>
                              </a>
                            </td>
                            <td>
                              <ul>
                                <li
                                  th:if="${us.usr_Roles.size() > 0}"
                                  th:each="ur : ${us.usr_Roles}"
                                  th:text="${ur.idRol.rol}"
                                ></li>
                                <li
                                  th:if="${us.usr_Roles.size() <= 0}"
                                  th:text="${'SIN ROLES ASIGNADOS'}"
                                ></li>
                              </ul>
                            </td>
                            <td class="text-center">
                              <a>
                                <button
                                  class="btn btn-success"
                                  type="button"
                                  title="AGREGAR ROL"
                                  data-toggle="tooltip"
                                  data-placement="bottom"
                                  th:data-value="${us.idUsuario}"
                                  onclick="buscarR(this.getAttribute('data-value'))"
                                >
                                  <i class="fas fa-user-cog"></i>
                                </button>
                              </a>
                              <a
                                th:href="@{'../../../../asignacionrol/' + ${us.idUsuario}}"
                              >
                                <button
                                  class="btn btn-primary"
                                  type="button"
                                  title="SELECCIONAR ENLACES"
                                  data-toggle="tooltip"
                                  data-placement="bottom"
                                >
                                  <i class="fas fa-file-medical"></i>
                                </button>
                              </a>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <!-- end col -->
              </div>
              <!-- end row -->
            </div>
            <!-- end container-fluid -->
          </div>
          <!-- end page-content-wrapper -->
        </div>
        <!-- End Page-content -->

        <div th:insert="~{layout/footer :: footer}"></div>
      </div>
      <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <div th:insert="~{layout/right-sidebar :: right-sidebar}"></div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <div
      class="modal fade text-left"
      id="success"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel9"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div id="replace"></div>
        </div>
      </div>
    </div>

    <script>
      function buscarR(valor) {
        $.ajax({
          url: "/roles/" + valor, // Reemplaza '/ruta_del_servidor' por la URL de tu servidor
          method: "GET", // Utiliza el método HTTP que corresponda (GET, POST, etc.)
          // Envía el parámetro "id" al servidor
          success: function (response) {
            $("#replace").html(response); // Actualiza el contenido del div con la respuesta del servidor
            $(".js-example-basic-multiple").select2();
            $("#success").modal("show");
          },
          error: function (xhr, status, error) {
            // Maneja los errores de la solicitud AJAX
            console.log(error);
          },
        });
      }
    </script>
    <div th:insert="~{layout/scripts :: scripts}"></div>
  </body>
</html>
